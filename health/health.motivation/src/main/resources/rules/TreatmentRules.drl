#created on: 17-oct-2011
package org.universAAL.AALApplication.health.motivation.treatment

#list any import classes here. 
import org.universaal.ontology.health.owl.Treatment;
import org.universAAL.AALApplication.health.motivation.motivatonalMessageManagement.MessageManager;
import org.universaal.ontology.owl.MotivationalMessageClassification;

#declare any global variables here 


#Whenever a treatment is detected a consent message is sent to the user

rule "Treatment Detection" no-loop  
	
	when
		detectedTreatment: Treatment(name != "")  // A new treatment, with a name, is detected
	then 
		TreatmentDetection.insertDetectedTreatment(detectedTreatment); //solo valido para JUnit
        MessageManager.sendMessageToUser(HeartFailure.MY_URI, Treatment.MY_URI,
                                        MotivationalStatusType.precontemplation, MotivationalMessageClassification.inquiry);
        System.out.println("Tratamiento " + detectedTreatment.getName()+ " detectado");//traza
        //en esta regla debe probarse tanto la deteccion del tratamiento como que se ha enviado bien el mensaje

		
end 

/*
rule "Treatment performance agreement" salience no-loop
	when
		//reciba al answered message correspondiente al primer mensaje y la respuesta
		//a la pregunta sea YES
	
	then 
	//cambiar el estado motivacional del treatment a "contemplation" 
	//se activan las reglas de contemplation	
	//c�lculo de la periodicidad con la que se mandar�n los mensajes de refuerzo
		
end

rule "Treatment performance disagreement" salience no-loop
	when
		//reciba al answered message correspondiente al primer mensaje y la respuesta
		//a la pregunta sea NO
	
	then 
	//no hace falta cambiar el estado motivacional del treatment a "precontemplation", porque ya lo tiene por defecto.
	//mensaje al usuario para averiguar la causa
	//se activan las reglas de precontemplation 	
		
end

rule "First activity performed" salience no-loop
	#include attributes such as "salience" here...
	when
	//cuando se detecta que la primera tarea ha sido realizada (lo ha introducido el usuario o por los aparatos)
	then 
	//el estado del tratamiento cambia a action	
	//se manda un mensaje de reward y feedback personalizado (si procede)
	//se activan las reglas de action y se cancelan las de precontemplation
end

rule "Threshold of maintenance achieved" salience no-loop
	when
	//cuando se sobrepase el umbral del 85% realizado (para tratamientos finitos) 
	// o el umbral que estime el medico en el permanente (por defecto un a�o)
	then 
	//el estado del tratamiento cambia a maintenance
	// se activan las reglas de action
end

rule "First activity never achieved" salience no-loop
	when
	//cuando no se haya realizado la primera actividad en 3 oportunidades
	then
	//se pasa del estado de contemplation a precontemplation 
	// se activan las reglas de precontemplation
end

rule "Non-fulfilment of action phase" salience no-loop
	when
	//cuando no se haya realizado tres de las sesiones establecidas
	then
	//se pasa del estado de action a contemplation y se toma la siguiente sesi�n como si fuera la primera 
	// se activan las reglas de contemplation
end

rule "Non-fulfilment of maintenance phase" salience no-loop
	when
	//cuando no se haya realizado tres de las sesiones establecidas
	then
	//se pasa del estado de maintenance a action  
	// se activan las reglas de action
end

rule "Change status to active" salience no-loop
	//esta regla deber�a activarse cada 24h
	when
	// la fecha actual coincida con la de inicio de tratamiento
	then
	// cambia el estado del tratamiento a activo 
end

rule "Change status to finished" salience no-loop
	when
	// llegue la fecha de fin del tratamiento sea mayor o igual que la fecha actual
	// y la completitud sea del 100%
	then
	// cambia el estado del tratamiento a terminado 
end

rule "Treatment prolonged automatically" salience no-loop
	when
	// llegue la fecha de fin del tratamiento 
	// y la completitud sea del 90%
	then
	// prolongamos el tratamiento (aumenta la fecha de fin)
	//avisamos al cargiver por si �l no admite que se extienda en el tiempo (le pedir�amos que lo cancelara)
	//se lo decimos tambi�n al usuario.
end

rule "Treatment cancelled" salience no-loop
	when
	// el tratamiento se cancele 
	then
	// notificamos al usuario.
end

rule "Increase completeness" salience no-loop
	when
	// se detecte una sessi�n realizada 
	then
	//se almacena en un array de sesiones completadas
	// aumenta una unidad la completitud del tratamiento.
end

rule "Treatment prolonged by caregiver" salience no-loop
	when
	// se detecte una ampliaci�n del plazo para la realizaci�n de un treatment 
	then
	//se deben recalcular las sesiones totales, lo que influye en la unidad de completitud
	//chequear las sesiones ya hechas y corregir la completitud.
end
*/